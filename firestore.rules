rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    function isAuthorized(request, resource) {
       return request.auth.uid == resource.data.uid ||
       request.auth.uid == request.resource.data.uid;
    }

    match /foods/{document} {
      function validateFoods(data) {
        return data.name is string &&
        data.description is string &&
        data.photo is string &&
        data.uid is string;
      }

      allow read: if isAuthorized(request, resource);
      allow write: if isAuthorized(request, resource) &&
      validateFoods(request.resource.data) 
    }
  }
}